# Introduction

This code is intended for use as a worker that runs jobs queued using
[python-rq](http://python-rq.org/). In particular, those jobs are expected to be
queued using, _e.g._
```
import rq
q = rq.Queue(connection=StrictRedis(host='redis'))
q.enqueue('webhook.job', payload)
```
where `payload` is a dictionary representing a JSON webhook generated by a
[private Docker registry](https://docs.docker.com/registry/notifications/)
(_e.g._ the [GitLab Container Registry](https://docs.gitlab.com/ce/user/project/container_registry.html))
or the special webhooks [generated by DockerHub](https://docs.docker.com/docker-hub/webhooks).

The [Webhook Queue](https://github.com/lscsoft/webhook-queue) queues webhooks
for use by this worker and exposes the redis queue to the `localhost`.

# Acknowledgements

The CVMFS publishing code derives largely from
[code](https://github.com/opensciencegrid/cvmfs-singularity-sync/) developed by
[Brian Bockelman](https://github.com/bbockelm) and
[Derek Weitzel](https://djw8605.github.io/) of the University of Nebraska and
the Open Science Grid (OSG). Their code was modified to support
[Python 3](#python-3), arbitrary CVMFS filesystems and to simplify intermediate
steps in the unpacking of the Docker image. Their work was released under the
Apache License 2.0 as is this work.

Although it has now diverged greatly, the file `cvmfs/publisher.py` was
originally forked from work performed by Vanessa Sochat for the Singularity
project. This is noted within the file and that file remains under the 3-Clause
BSD License.

# Running
Install this code to a directory of your choice and run `rq worker`. You may
need to set environment variables as below.
```
LC_ALL=C.UTF-8 LANG=C.UTF-8 rq worker
```

## Python 3
This code is deliberately aimed at Python 3. I have made no attempt to make it
Python 2.x compatible though I'd imagine it might require only importing the
future `print` function. I'd gladly accept pull requests to support Python 2.x.
